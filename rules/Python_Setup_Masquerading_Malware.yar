rule Python_Setup_Masquerading_Malware {
    meta:
        author = "RuleLLM"
        description = "Detects malicious Python setup scripts that attempt to hide malicious code within legitimate-looking package setup"
        confidence = 90
        severity = 85
    strings:
        $setup_import = "from distutils.core import setup"
        $try_except = "try:" wide
        $subprocess = "subprocess" wide
        $powershell = "powershell" wide
        $hidden_exec = "CREATE_NO_WINDOW" wide
    condition:
        filesize < 15KB and
        $setup_import and
        $try_except and
        (($subprocess and $powershell) or $hidden_exec)
}