rule Python_Malware_SetupTools_Backdoor {
    meta:
        author = "RuleLLM"
        description = "Detects malicious setup.py files with custom install classes"
        confidence = 85
        severity = 95
    strings:
        $setup_import = "from setuptools import setup"
        $install_class = /class\s+\w+Install\w*\(\s*install\s*\):/
        $cmdclass_pattern = /cmdclass\s*=\s*\{.*\}/
        $malicious_import = /from\s+\w+\s+import\s+\w+/
        $malicious_call = /\w+\(\s*\)/
    condition:
        all of ($setup_import, $install_class, $cmdclass_pattern) and 
        1 of ($malicious_import, $malicious_call)
}