rule Suspicious_Python_Setup_With_Malware {
    meta:
        author = "RuleLLM"
        description = "Detects Python setup scripts with embedded malicious code"
        confidence = 85
        severity = 90

    strings:
        $setup = "from distutils.core import setup" ascii
        $subprocess = "import subprocess" ascii
        $encoded_command = "powershell -WindowStyle Hidden -EncodedCommand" ascii
        $try_except = "try:" ascii

    condition:
        $setup and $subprocess and $encoded_command and $try_except
}