rule Malware_Behavioral_Detection {
    meta:
        description = "Detects malware based on behavioral characteristics"
        author = "YARA Rule Expert"
        date = "2023-10-01"
        version = "1.0"

    strings:
        $api_call_sequence_1 = { 55 8B EC 83 EC 08 6A 00 6A 00 68 ?? ?? ?? ?? FF 15 ?? ?? ?? ?? }
        $api_call_sequence_2 = { 55 8B EC 83 EC 0C 6A 00 68 ?? ?? ?? ?? 68 ?? ?? ?? ?? FF 15 ?? ?? ?? ?? }
        $network_pattern = /conn\.request\("POST", "[^"]+", body=/
        $command_execution = /CreateProcess[AW]?\s*\(/
        $registry_modification = /RegSetValueEx[AW]?\s*\(/
        $file_creation = /CreateFile[AW]?\s*\(/

    condition:
        (2 of ($api_call_sequence_1, $api_call_sequence_2)) and
        (all of ($network_pattern, $command_execution)) or
        (all of ($registry_modification, $file_creation))
}